sample_name_l <- lapply(df_list, `[`, 1,) # extract all names
sample_name_a <- do.call(c, sample_name_l)
View(sample_name_a)
# load tsv file lists
df_list <- lapply(file_list,
FUN = function(files) {
read.table(files, header = FALSE, sep = "\t", skip = 1, comment.char = "", check.names = F)
})
# check names to be unique
sample_name_l <- lapply(df_list, `[`, 1,) # extract all names
View(sample_name_l)
head(sample_name_l[1])
sample_name_a <- do.call(c, sample_name_l)
View(sample_name_l)
sample_name_l <- lapply(sample_name_l. as.array)
sample_name_l <- lapply(sample_name_l. as.vector)
sample_name_l <- lapply(sample_name_l, unlist)
View(sample_name_l)
# check names to be unique
sample_name_l <- lapply(df_list, `[`, 1,) # extract all names
View(sample_name_l)
sample_name_l <- lapply(sample_name_l, unlist)
sample_name_a <- do.call(c, sample_name_l)
# check names to be unique
sample_name_l <- lapply(df_list, `[`, 1,) # extract all names
sample_name_l <- lapply(sample_name_l, as.vector)
View(sample_name_l)
sample_name_l <- lapply(sample_name_l, unlist)
head(sample_name_l[1])
# check names to be unique
sample_name_l <- lapply(df_list, `[`, 1,) # extract all names
sample_name_l <- lapply(sample_name_l, as.character)
head(sample_name_l[1])
?read.table
# load tsv file lists
df_list <- lapply(file_list,
FUN = function(files) {
read.delim(files, header = FALSE, sep = "\t", skip = 1, check.names = F)
})
# check names to be unique
sample_name_l <- lapply(df_list, `[`, 1,) # extract all names
View(sample_name_l)
# load tsv file lists
df_list <- lapply(file_list,
FUN = function(files) {
read.table(files, header = FALSE, sep = "\t", skip = 1, comment.char = "", check.names = F)
})
# check names to be unique
sample_name_l <- lapply(df_list, `[`, 1,) # extract all names
read.table(files, header = FALSE, sep = "\t", skip = 1, comment.char = "", check.names = F, stringsAsFactors = FALSE)
# load tsv file lists
df_list <- lapply(file_list,
FUN = function(files) {
read.table(files, header = FALSE, sep = "\t", skip = 1, comment.char = "", check.names = F, stringsAsFactors = FALSE)
})
# check names to be unique
sample_name_l <- lapply(df_list, `[`, 1,) # extract all names
View(sample_name_l)
# check names to be unique
sample_name_l <- lapply(df_list, `[`, 1,, drop=FALSE) # extract all names
View(sample_name_l)
# check names to be unique
sample_name_l <- lapply(df_list, `[`, 1,, drop=TRUE) # extract all names
View(sample_name_l)
head(sample_name_l[1])
read.table(files, header = FALSE, sep = "\t", skip = 1, comment.char = "", check.names = F, stringsAsFactors = FALSE)
# load tsv file lists
df_list <- lapply(file_list,
FUN = function(files) {
read.table(files, header = FALSE, sep = "\t", skip = 1, comment.char = "", check.names = F, stringsAsFactors = FALSE)
})
# check names to be unique
sample_name_l <- lapply(df_list, `[`, 1,) # extract all names
sample_name_l <- lapply(sample_name_l, as.character)
head(sample_name_l[1])
sample_name_a <- do.call(c, sample_name_l)
# remove taxonomy column
sample_name_clean <- sample_name_a[! sample_name_a %in% c("#OTU ID", "Taxonomy")]
# extract duplicate names
dup_names <- sample_name_clean[duplicated(sample_name_clean)]
if (length(dup_names) == 0)
if (length(dup_names) == 0)
df_merge <- Reduce(function(...) merge(..., all = TRUE, by = "#OTU ID"), df_list)
View(sample_name_l)
dup_names
df_merge <- Reduce(function(...) merge(..., all = TRUE, by = "V1"), df_list)
View(df_merge)
View(df_merge2)
dim(df_merge)[1]
# write.out a biomformat tsv file
write.table(df_merge, file_out, sep = "\t", col.names = FALSE, row.names = "# Constructed from biom file", quote = FALSE)
# write.out a biomformat tsv file
write.table(df_merge, file_out, sep = "\t", row.names = FALSE, col.names = "# Constructed from biom file", quote = FALSE)
?write.table
# write.out a biomformat tsv file
header <- "# Constructed from biom file"
write(header, file_out)
write.table(df_merge, file_out, sep = "\t", row.names = FALSE, col.names = FALSE, quote = FALSE, append = TRUE)
?requireNamespace()
!requireNamespace("biomformat", quietly = TRUE)
BiocManager::install("argparse")
#################################################################
# Function:  Merge two collapsed biom tables based on the taxa/OTUID
# Call: Rscript merge_colllapsed_tables.R -i *.biom -o merged.biom
# R packages used: optparse, biomformat
# Authors: Yan Hui
# Last update: 2020-11-6, Yan Hui
# University of Copenhagen
#################################################################
# install necessary packages
p <- c("argparse")
checkPackage <- function(p) {
if (!is.element(p, installed.packages()[,1]))
install.packages(p, dep=TRUE, repos="http://cran.us.r-project.org/")
suppressWarnings(suppressMessages(invisible(require(p, character.only=TRUE))))
}
invisible(lapply(p, checkPackage))
!is.element(p, installed.packages()[,1])
is.element(p, installed.packages()
is.element(p, installed.packages()[,1])
installed.packages()[,1]
(require(p, character.only=TRUE)
require(p, character.only=TRUE)
invisible(require(p, character.only=TRUE)
)
?require
?invisible
install.packages("biomformat")
install.packages("biomformat")
r
R
version
#################################################################
# Function:  Merge two collapsed biom tables based on the taxa/OTUID
# Call: Rscript merge_colllapsed_tables.R -i *.biom -o merged.biom
# R packages used: optparse, biomformat
# Authors: Yan Hui
# Last update: 2020-11-6, Yan Hui
# University of Copenhagen
#################################################################
# install necessary packages
p <- c("argparse", "biomformat")
checkPackage <- function(p) {
if (!requireNamespace(p, quietly = TRUE)){
if (!requireNamespace("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install(p)
}
}
invisible(lapply(p, checkPackage))
#################################################################
# Function:  Merge two collapsed biom tables based on the taxa/OTUID
# Call: Rscript merge_colllapsed_tables.R -i *.biom -o merged.biom
# R packages used: optparse, biomformat
# Authors: Yan Hui
# Last update: 2020-11-6, Yan Hui
# University of Copenhagen
#################################################################
# install necessary packages
p <- c("argparse", "biomformat")
loadPackage <- function(p) {
if (!requireNamespace(p, quietly = TRUE)){
if (!requireNamespace("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install(p)
require(p)
}
}
invisible(lapply(p, loadPackage))
?ArgumenParser
??ArgumenParser
## parsing arguments
parser <- ArgumentParser(description="Merge multiple collapsed feature tables (biom format)")
#################################################################
# Function:  Merge two collapsed biom tables based on the taxa/OTUID
# Call: Rscript merge_colllapsed_tables.R -i *.biom -o merged.biom
# R packages used: optparse, biomformat
# Authors: Yan Hui
# Last update: 2020-11-6, Yan Hui
# University of Copenhagen
#################################################################
# install necessary packages
p <- c("argparse", "biomformat")
loadPackage <- function(p) {
if (!requireNamespace(p, quietly = TRUE)){
if (!requireNamespace("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install(p)
require(p)
}
}
invisible(lapply(p, loadPackage))
## clean R environment
rm(list = ls())
setwd('./')
## parsing arguments
parser <- ArgumentParser(description="Merge multiple collapsed feature tables (biom format)")
library("argparse")
## parsing arguments
parser <- ArgumentParser(description="Merge multiple collapsed feature tables (biom format)")
View(parser)
?add_arguemnt
?ArgumentParser
#################################################################
# Function:  Merge two collapsed biom tables based on the taxa/OTUID
# Call: Rscript merge_colllapsed_tables.R -i *.biom -o merged.biom
# R packages used: optparse, biomformat
# Authors: Yan Hui
# Last update: 2020-11-6, Yan Hui
# University of Copenhagen
#################################################################
# install necessary packages
p <- c("optparse", "biomformat")
loadPackage <- function(p) {
if (!requireNamespace(p, quietly = TRUE)){
if (!requireNamespace("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install(p)
require(p)
}
}
invisible(lapply(p, loadPackage))
## clean R environment
rm(list = ls())
setwd('./')
library("optparse")
?make_option
#############################################
args <- commandArgs(trailingOnly=TRUE)
?make_option
# make option list and parse command line
option_list <- list(
make_option(c("-i", "--in_file"), type="character", help="Input a collapsed feature table (biom format-like) [Required]"),
make_option(c("-o", "--out_file"), type="character", default='merged.biom', help="Export a merged feature table (biom format-like) [default %default]"),
make_option(c("-z", "--na2zero"), type="logical", default=TRUE, help="transform NA values to zeros [Optional, default %default]")
)
opts <- parse_args(OptionParser(option_list=option_list), args=args)
View(opts)
# paramenter checking
if(is.null(opts$table_file)) stop('Please input the feature tables')
View(opts)
View(opts)
?merge
arges
args
?commandArgs()
tb1 <- data.frame(a=c(1,2,3), b=c(2,31,1),f=c(3,4,5))
tb2 <- data.frame(a=c(1,2),e=c(2,4),f=c(3,4))
merge(tb1,tb2, by="a")
merge(tb1,tb2, by="a", all = TRUE)
# support for tsv format
#file_list <- c("/home/yanhui/bioscript/collapsed1.txt","/home/yanhui/bioscript/collapsed2.txt","/home/yanhui/bioscript/collapsed3.txt")
#file_out <- "/home/yanhui/bioscript/merge.txt"
#na2zero <- FALSE
biom_list <- c("/home/yanhui/bioscript/collapsed1.biom","/home/yanhui/bioscript/collapsed2.biom","/home/yanhui/bioscript/collapsed3.biom")
# support for tsv format
#file_list <- c("/home/yanhui/bioscript/collapsed1.txt","/home/yanhui/bioscript/collapsed2.txt","/home/yanhui/bioscript/collapsed3.txt")
#file_out <- "/home/yanhui/bioscript/merge.txt"
#na2zero <- FALSE
file_list <- c("/home/yanhui/bioscript/collapsed1.biom","/home/yanhui/bioscript/collapsed2.biom","/home/yanhui/bioscript/collapsed3.biom")
#if (biom_format == TRUE){
biom_list <- lapply(file_list, read_biom)
# support for tsv format
#file_list <- c("/home/yanhui/bioscript/collapsed1.txt","/home/yanhui/bioscript/collapsed2.txt","/home/yanhui/bioscript/collapsed3.txt")
#file_out <- "/home/yanhui/bioscript/merge.txt"
#na2zero <- FALSE
library(biomformat)
file_list <- c("/home/yanhui/bioscript/collapsed1.biom","/home/yanhui/bioscript/collapsed2.biom","/home/yanhui/bioscript/collapsed3.biom")
#if (biom_format == TRUE){
biom_list <- lapply(file_list, read_biom)
View(biom_list)
df_list <- lapply(biom_list, function(x) as(biom_data(x), "matrix"))
View(df_list)
#}
head(df_list[1])
#}
head(df_list[1,])
?as
View(df_list)
#}
biom_list[1]
#}
biom_data(biom_list[1])
#}
as(biom_data(biom_list[1]),"matrix")
#}
as(biom_data(biom_list[[1]]),"matrix")
reform <- function(x) {
x <- rbind(colnames(x),x)
x <- cbind(rownames(x),x)
colnames(x)[1] <- "#OTU ID"
return(x)
}
df_list <- lapply(df_list, reform)
head(df_list[1])
reform <- function(x) {
x <- rbind(colnames(x),x)
x <- cbind(rownames(x),x)
colnames(x) <- NULL
rownames(x) <- NULL
x <- as.data.frame(x)
return(x)
}
df_list <- lapply(df_list, reform)
head(df_list[1])
#if (biom_format == TRUE){
biom_list <- lapply(file_list, read_biom)
df_list <- lapply(biom_list, function(x) as(biom_data(x), "matrix"))
reform <- function(x) {
x <- rbind(colnames(x),x)
x <- cbind(rownames(x),x)
colnames(x) <- NULL
rownames(x) <- NULL
x <- as.data.frame(x)
return(x)
}
df_list <- lapply(df_list, reform)
head(df_list[1])
reform <- function(x) {
x <- rbind(colnames(x),x)
x <- cbind(rownames(x),x)
x[1,1] <- "#OTU ID"
colnames(x) <- NULL
rownames(x) <- NULL
x <- as.data.frame(x)
return(x)
}
df_list <- lapply(df_list, reform)
warnings
warnings()
#if (biom_format == TRUE){
biom_list <- lapply(file_list, read_biom)
df_list <- suppressWarnings(lapply(df_list, reform))
?make_biom
#####################################################
# manipulating the dts
# check names to be unique
sample_name_l <- lapply(df_list, `[`, 1,) # extract all names
sample_name_l <- lapply(sample_name_l, as.character)
sample_name_a <- do.call(c, sample_name_l)
# remove taxonomy column
sample_name_clean <- sample_name_a[! sample_name_a %in% c("#OTU ID", "Taxonomy")]
# extract duplicate names
dup_names <- sample_name_clean[duplicated(sample_name_clean)]
# merge tables
if (length(dup_names) == 0){
df_merge <- Reduce(function(...) merge(..., all = TRUE, by = "V1"), df_list)
} el
# merge tables
if (length(dup_names) == 0)
df_merge <- Reduce(function(...) merge(..., all = TRUE, by = "V1"), df_list)
# check if has overlapped taxa
if (dim(df_merge)[1] == 1)
taxa_warning <- "No overlapped taxa found, please check if the taxa format is uniform. e.g. taxonomy separed by \";\" or \"; \" "
dup_names
sample_name_a
#####################################################
# manipulating the dts
# check names to be unique
sample_name_l <- lapply(df_list, `[`, 1,) # extract all names
sample_name_l <- lapply(sample_name_l, as.character)
View(sample_name_l)
#####################################################
# manipulating the dts
# check names to be unique
sample_name_l <- lapply(df_list, `[`, 1,) # extract all names
View(sample_name_l)
?as.data.frame
# load the collapsed tables
# load the biom_format
if (biom_format == TRUE){
biom_list <- lapply(file_list, read_biom)
df_list <- lapply(biom_list, function(x) as(biom_data(x), "matrix"))
reform <- function(x) {
x <- rbind(colnames(x),x)
x <- cbind(rownames(x),x)
colnames(x) <- NULL
rownames(x) <- NULL
x <- as.data.frame(x, stringsAsFactors =FALSE)
x[1,1] <- "#OTU ID"
return(x)
}
df_list <- lapply(df_list, reform)
} else{
# load tsv file lists
df_list <- lapply(file_list,
FUN = function(files) {
read.table(files, header = FALSE, sep = "\t", skip = 1, comment.char = "", check.names = F, stringsAsFactors = FALSE)
})
}
reform <- function(x) {
x <- rbind(colnames(x),x)
x <- cbind(rownames(x),x)
colnames(x) <- NULL
rownames(x) <- NULL
x <- as.data.frame(x, stringsAsFactors =FALSE)
x[1,1] <- "#OTU ID"
return(x)
}
df_list <- lapply(df_list, reform)
# load the collapsed tables
# load the biom_format
#if (biom_format == TRUE){
biom_list <- lapply(file_list, read_biom)
df_list <- lapply(biom_list, function(x) as(biom_data(x), "matrix"))
reform <- function(x) {
x <- rbind(colnames(x),x)
x <- cbind(rownames(x),x)
colnames(x) <- NULL
rownames(x) <- NULL
x <- as.data.frame(x, stringsAsFactors = FALSE)
x[1,1] <- "#OTU ID"
return(x)
# }
df_list <- lapply(df_list, reform)
} else{
# load tsv file lists
df_list <- lapply(file_list,
FUN = function(files) {
read.table(files, header = FALSE, sep = "\t", skip = 1, comment.char = "", check.names = F, stringsAsFactors = FALSE)
})
}
reform <- function(x) {
df_list <- lapply(biom_list, function(x) as(biom_data(x), "matrix"))
reform <- function(x) {
x <- cbind(rownames(x),x)
colnames(x) <- NULL
rownames(x) <- NULL
x <- as.data.frame(x, stringsAsFactors = FALSE)
x[1,1] <- "#OTU ID"
return(x)
reform <- function(x) {
x <- rbind(colnames(x),x)
x <- cbind(rownames(x),x)
colnames(x) <- NULL
rownames(x) <- NULL
x <- as.data.frame(x, stringsAsFactors = FALSE)
x[1,1] <- "#OTU ID"
return(x)
}
df_list <- lapply(df_list, reform)
# load the collapsed tables
# load the biom_format
#if (biom_format == TRUE){
biom_list <- lapply(file_list, read_biom)
df_list <- lapply(biom_list, function(x) as(biom_data(x), "matrix"))
reform <- function(x) {
x <- rbind(colnames(x),x)
x <- cbind(rownames(x),x)
colnames(x) <- NULL
rownames(x) <- NULL
x <- as.data.frame(x, stringsAsFactors = FALSE)
x[1,1] <- "#OTU ID"
return(x)
}
df_list <- lapply(df_list, reform)
#####################################################
# manipulating the dts
# check names to be unique
sample_name_l <- lapply(df_list, `[`, 1,) # extract all names
sample_name_l <- lapply(sample_name_l, as.character)
sample_name_a <- do.call(c, sample_name_l)
#####################################################
# manipulating the dts
# check names to be unique
sample_name_l <- lapply(df_list, `[`, 1,) # extract all names
View(sample_name_l)
# load the collapsed tables
# load the biom_format
biom_format ==TRUE
# load the collapsed tables
# load the biom_format
biom_format <- TRUE
if (biom_format == TRUE){
biom_list <- lapply(file_list, read_biom)
df_list <- lapply(biom_list, function(x) as(biom_data(x), "matrix"))
reform <- function(x) {
x <- rbind(colnames(x),x)
x <- cbind(rownames(x),x)
colnames(x) <- NULL
rownames(x) <- NULL
x <- as.data.frame(x, stringsAsFactors = FALSE)
x[1,1] <- "#OTU ID"
return(x)
}
df_list <- lapply(df_list, reform)
} else{
# load tsv file lists
df_list <- lapply(file_list,
FUN = function(files) {
read.table(files, header = FALSE, sep = "\t", skip = 1, comment.char = "", check.names = F, stringsAsFactors = FALSE)
})
}
#####################################################
# manipulating the dts
# check names to be unique
sample_name_l <- lapply(df_list, `[`, 1,) # extract all names
View(sample_name_l)
sample_name_l <- lapply(sample_name_l, as.character)
View(sample_name_l)
sample_name_a <- do.call(c, sample_name_l)
# remove taxonomy column
sample_name_clean <- sample_name_a[! sample_name_a %in% c("#OTU ID", "Taxonomy")]
# extract duplicate names
dup_names <- sample_name_clean[duplicated(sample_name_clean)]
?make_biom
# merge tables
if (length(dup_names) == 0)
df_merge <- Reduce(function(...) merge(..., all = TRUE, by = "V1"), df_list)
View(option_list)
View(df_merge)
?write_biom()
